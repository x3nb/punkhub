<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Punky Community</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Vast+Shadow&display=swap" rel="stylesheet" />
<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
body {
  margin: 0;
  background: #222; /* darker background for papercut effect */
  font-family: 'Press Start 2P', monospace;
  color: #333; /* base text color */
}

/* AUTH */
#auth {
  height: 100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.auth-box {
  border: 3px solid #4B0082; /* deep purple border for papercut style */
  padding: 30px;
  background:#f0f0f0; /* light grey for papercut look */
  box-shadow: inset 4px 4px 8px #999, inset -4px -4px 8px #fff; /* shading for depth */
  text-align:center;
  border-radius: 10px;
  max-width: 300px;
}

.auth-box h2 {
  font-family: 'Press Start 2P', monospace;
  font-size: 1.2em;
  margin-bottom: 20px;
  color: #4B0082; /* deep purple text */
}

.auth-box input {
  width: 90%;
  margin: 8px 0;
  padding: 10px;
  background:#f0f0f0;
  color:#333;
  border:2px solid #999; /* grey border for papercut look */
  font-family:inherit;
  border-radius: 5px;
  box-shadow: inset 2px 2px 5px #ccc, inset -2px -2px 5px #fff;
}

.auth-box button {
  margin-top:10px;
  padding:10px 20px;
  background:#4B0082; /* deep purple */
  color:#fff;
  border:none;
  cursor:pointer;
  border-radius: 5px;
  box-shadow: 2px 2px 5px #999, -2px -2px 5px #fff; /* papercut shading */
  font-family: 'Press Start 2P', monospace;
}

/* BOARD styles */
#board {
  padding:20px;
  background: #222;
}

header {
  display:flex;
  align-items:center;
  gap:15px;
  margin-bottom:20px;
  padding: 10px;
  background: #444;
  box-shadow: inset 4px 4px 8px #222, inset -4px -4px 8px #666;
  border-radius: 10px;
}

header img {
  width:60px;
  height:60px;
  border-radius:50%;
  border:3px solid #4B0082;
  object-fit:cover;
  box-shadow: 2px 2px 4px #222, -2px -2px 4px #ccc;
}

#welcome {
  color:#eee;
  font-family: 'Press Start 2P', monospace;
  font-size: 0.8em;
}

#notes {
  display:flex;
  flex-wrap:wrap;
  gap:15px;
}

.note {
  width:140px;
  min-height:110px;
  padding:10px;
  background:#d3d3d3;
  color:#222;
  transform: rotate(var(--r));
  box-shadow: inset 4px 4px 8px #999, inset -4px -4px 8px #fff;
  font-size:0.6em;
  border-radius: 8px;
}

/* Textarea styling with papercut shading */
textarea {
  width:100%;
  margin-top:15px;
  padding:10px;
  background:#f0f0f0;
  color:#333;
  border:2px dashed #999;
  font-family:inherit;
  border-radius: 5px;
  box-shadow: inset 2px 2px 5px #ccc, inset -2px -2px 5px #fff;
}
</style>
</head>
<body>

<!-- AUTH -->
<div id="auth">
  <div class="auth-box">
    <h2>PUNK ZEN</h2>
    <input id="username" placeholder="username (signup only)">
    <input id="email" placeholder="email">
    <input id="password" type="password" placeholder="password">
    <button onclick="signup()">SIGN UP</button>
    <button onclick="login()">LOG IN</button>
  </div>
</div>

<!-- BOARD -->
<div id="board" class="hidden">
  <header>
    <img id="avatar" src="https://placehold.co/100x100" />
    <div>
      <div id="welcome"></div>
      <input type="file" onchange="uploadAvatar(event)">
    </div>
  </header>

  <div id="notes"></div>

  <textarea id="noteInput" placeholder="Leave your mark..."></textarea>
  <button onclick="postNote()">POST NOTE</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Floating shapes
  const shapeCount = 20;
  const shapesContainer = document.getElementById('shapes');
  for(let i=0;i<shapeCount;i++){
    const shape=document.createElement('div');
    shape.className='shape';
    shape.style.width=(10+Math.random()*30)+'px';
    shape.style.height=shape.style.width;
    shape.style.top=Math.random()*100+'%';
    shape.style.left=Math.random()*100+'%';
    shape.style.background='linear-gradient(45deg,#f0f,#0ff,#ff0)';
    shape.style.transform=`rotate(${Math.random()*360}deg)`;
    shape.style.animationDuration=(10+Math.random()*20)+'s';
    shapesContainer.appendChild(shape);
  }

  // Supabase init
  const supabaseUrl = 'https://hwymepujsvfqjkbullaf.supabase.co'; // <-- Your Supabase URL
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3eW1lcHVqc3ZmcWprYnVsbGFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MDczOTQsImV4cCI6MjA4NDI4MzM5NH0.V6-Cm331IocSXDqe-v6iAZA3TV1STyEHyQI43lcXU_4'; // <-- Your Supabase anon key
  window.supabase = supabase.createClient(supabaseUrl, supabaseKey);

  window.authMode = null;

  // Show forms
  window.showSignUp = () => { window.authMode='signup'; showForm(); }
  window.showSignIn = () => { window.authMode='signin'; showForm(); }
  window.cancelAuth = () => { document.getElementById('auth-form').style.display='none'; document.getElementById('auth-buttons').style.display='flex'; document.getElementById('signup-message').innerText=''; window.authMode=null; }

  function showForm() {
    document.getElementById('auth-form').style.display='block';
    document.getElementById('auth-buttons').style.display='none';
    document.getElementById('signup-message').innerText='';
  }

  // Submit auth
  window.submitAuth = async () => {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    if(!email||!password){ alert('Enter email and password'); return; }

    if(window.authMode==='signup'){
      const { data, error } = await supabase.auth.signUp({ email, password });
      if(error){ alert('Sign-up error: '+error.message); return; }
      document.getElementById('signup-message').innerText='Sign-up successful! Check your email for confirmation.';
      // Only show Log In button after signup
      document.getElementById('auth-buttons').innerHTML='<button onclick="showSignIn()">Log In</button>';
      document.getElementById('auth-buttons').style.display='flex';
      document.getElementById('auth-form').style.display='none';
    } else if(window.authMode==='signin'){
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if(error){
        if(error.message.includes('Email not confirmed')){
          alert('Your email is not confirmed yet. Check your inbox or request a new confirmation.');
        } else {
          alert('Sign-in error: '+error.message);
        }
        return;
      }
      // Login success
      window.currentUser = data.user;
      document.getElementById('auth-form').style.display='none';
      document.getElementById('auth-buttons').style.display='none';
      document.getElementById('main-content').style.display='block';
      showGreeting();
    }
  };

  // Greeting
  function showGreeting() {
    const header=document.getElementById('chat-header');
    const loading=document.getElementById('loading-indicator');
    header.innerText=`Welcome, ${window.currentUser.email}`;
    loading.style.display='none';
    const chatDiv=document.getElementById('chat');
    chatDiv.innerHTML=`<p>Hello ${window.currentUser.email}! Welcome to your punky community!</p>`;
    chatDiv.style.display='block';
  }

  // Menu setup
  const menuItems=[
    { title:'ABOUT', synopsis:'Learn about the punky community and its roots.', link:'https://en.wikipedia.org/wiki/Punk_rock' },
    { title:'MUSIC', synopsis:'Discover punk-inspired tunes and playlists.', link:'https://www.punknews.org/' },
    { title:'SHOP', synopsis:'Get punk fashion and accessories.', link:'https://punkclothing.com/' },
    { title:'BLOG', synopsis:'Read stories and updates from the community.', link:'https://punkblog.com/' }
  ];

  const menuContainer=document.getElementById('menu');
  const synopsisDiv=document.getElementById('synopsis');
  menuItems.forEach(item=>{
    const div=document.createElement('div');
    div.className='menu-item';
    div.innerText=item.title;
    div.onclick=()=>{ synopsisDiv.innerHTML=`<p>${item.synopsis}</p><a href="${item.link}" target="_blank" style="color:#f0f;">Visit Link</a>`; };
    menuContainer.appendChild(div);
  });

});
</script>
</body>
</html>
