<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Punky Community</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Vast+Shadow&display=swap" rel="stylesheet" />
<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body { margin:0; padding:0; background:#000; font-family:'Press Start 2P',cursive; color:white; overflow:hidden; }
  .background-shapes { position:absolute; top:0; left:0; width:100%; height:100%; overflow:hidden; }
  .shape { position:absolute; border-radius:50%; animation:float 10s infinite linear; }
  @keyframes float { 0% { transform:translateY(0) rotate(0deg);} 100% { transform:translateY(-100vh) rotate(360deg);} }
  .container { position:relative; z-index:1; text-align:center; padding:20px; }
  #user-avatar { width:100px; height:100px; background:#f0f; border-radius:50%; margin:20px auto; }
  #auth-buttons button { margin:10px; padding:10px 20px; background:#f0f; color:white; border:none; cursor:pointer; font-family:'Press Start 2P',cursive; }
  .paper { background: rgba(0,0,0,0.8); border:2px solid #f0f; padding:20px; margin:20px auto; max-width:400px; }
  .chat-header { font-size:1.2em; margin-bottom:10px; }
  .loading { color:#0ff; }
  .greet { margin:20px 0; }
  .menu { display:flex; justify-content:space-around; margin:20px 0; flex-wrap:wrap; }
  .menu-item { cursor:pointer; padding:10px; background:#ff0; color:black; border-radius:5px; margin:5px; font-family:'Press Start 2P',cursive; }
  #synopsis { margin-top:20px; text-align:left; }
  #signup-message { color:lime; font-weight:bold; margin-top:10px; }
</style>
</head>
<body>

<div class="background-shapes" id="shapes"></div>

<div class="container">
  <div id="user-avatar"></div>

  <div id="auth-buttons">
    <button onclick="showSignUp()">Sign Up</button>
    <button onclick="showSignIn()">Log In</button>
  </div>

  <div class="paper" id="auth-form" style="display:none;">
    <h2 style="font-family:'Vast Shadow',cursive;">Welcome to the Punk Tribe</h2>
    <input type="email" id="auth-email" placeholder="Email" style="margin:10px; padding:10px; font-family:'Press Start 2P';" /><br>
    <input type="password" id="auth-password" placeholder="Password" style="margin:10px; padding:10px; font-family:'Press Start 2P';" /><br>
    <button onclick="submitAuth()">Submit</button>
    <button onclick="cancelAuth()">Cancel</button>
    <div id="signup-message"></div>
  </div>

  <div class="paper" id="main-content" style="display:none;">
    <div class="chat-header" id="chat-header">Loading...</div>
    <div class="loading" id="loading-indicator">Connecting to the punk chat...</div>
    <div id="chat" class="greet"></div>
    <div class="menu" id="menu"></div>
    <div id="synopsis"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Floating shapes
  const shapeCount = 20;
  const shapesContainer = document.getElementById('shapes');
  for (let i=0;i<shapeCount;i++){
    const shape=document.createElement('div');
    shape.className='shape';
    shape.style.width=(10+Math.random()*30)+'px';
    shape.style.height=shape.style.width;
    shape.style.top=Math.random()*100+'%';
    shape.style.left=Math.random()*100+'%';
    shape.style.background=`linear-gradient(45deg,#f0f,#0ff,#ff0)`;
    shape.style.transform=`rotate(${Math.random()*360}deg)`;
    shape.style.animationDuration=(10+Math.random()*20)+'s';
    shapesContainer.appendChild(shape);
  }

  // Supabase init
  const supabaseUrl = 'https://hwymepujsvfqjkbullaf.supabase.co'; // <-- Your Supabase URL
  const supabaseKey = ''; // <-- Your Supabase anon key
  window.supabase = supabase.createClient(supabaseUrl, supabaseKey);

  window.authMode = null;

  // Show forms
  window.showSignUp = () => { window.authMode='signup'; showForm(); }
  window.showSignIn = () => { window.authMode='signin'; showForm(); }
  window.cancelAuth = () => { document.getElementById('auth-form').style.display='none'; document.getElementById('auth-buttons').style.display='block'; document.getElementById('signup-message').innerText=''; window.authMode=null; }

  function showForm() {
    document.getElementById('auth-form').style.display='block';
    document.getElementById('auth-buttons').style.display='none';
    document.getElementById('signup-message').innerText='';
  }

  // Submit auth
  window.submitAuth = async () => {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    if(!email||!password){ alert('Enter email and password'); return; }

    if(window.authMode==='signup'){
      const { user, error } = await supabase.auth.signUp({ email, password });
      if(error){ alert('Sign-up error: '+error.message); return; }
      // Notify user
      document.getElementById('signup-message').innerText='Sign-up successful! Check your email for confirmation.';
      // After signup, only show "Log In"
      document.getElementById('auth-buttons').innerHTML='<button onclick="showSignIn()">Log In</button>';
    } else if(window.authMode==='signin'){
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if(error){
        if(error.message.includes('Email not confirmed')){ 
          alert('Your email is not confirmed yet. Check your inbox or request a new confirmation.');
        } else {
          alert('Sign-in error: '+error.message);
        }
        return;
      }
      // Login success
      window.currentUser = data.user;
      document.getElementById('auth-form').style.display='none';
      document.getElementById('auth-buttons').style.display='none';
      document.getElementById('main-content').style.display='block';
      showGreeting();
    }
  };

  // Greeting
  function showGreeting() {
    const header=document.getElementById('chat-header');
    const loading=document.getElementById('loading-indicator');
    header.innerText=`Welcome, ${window.currentUser.email}`;
    loading.style.display='none';
    const chatDiv=document.getElementById('chat');
    chatDiv.innerHTML=`<p>Hello ${window.currentUser.email}! Welcome to your punky community!</p>`;
    chatDiv.style.display='block';
  }

  // Menu setup
  const menuItems=[
    { title:'ABOUT', synopsis:'Learn about the punky community and its roots.', link:'https://en.wikipedia.org/wiki/Punk_rock' },
    { title:'MUSIC', synopsis:'Discover punk-inspired tunes and playlists.', link:'https://www.punknews.org/' },
    { title:'SHOP', synopsis:'Get punk fashion and accessories.', link:'https://punkclothing.com/' },
    { title:'BLOG', synopsis:'Read stories and updates from the community.', link:'https://punkblog.com/' }
  ];

  const menuContainer=document.getElementById('menu');
  const synopsisDiv=document.getElementById('synopsis');
  menuItems.forEach(item=>{
    const div=document.createElement('div');
    div.className='menu-item';
    div.innerText=item.title;
    div.onclick=()=>{ synopsisDiv.innerHTML=`<p>${item.synopsis}</p><a href="${item.link}" target="_blank" style="color:#f0f;">Visit Link</a>`; };
    menuContainer.appendChild(div);
  });

});
</script>
</body>
</html>
